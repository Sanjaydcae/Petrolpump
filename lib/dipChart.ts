// Dip Chart Lookup Utility
// Uses BPCL calibration chart data to convert DIP reading to Liters

// 15KL Tank Dip Chart Data (DIP in cm -> [Liters, Increment per mm])
// Key: dip reading in cm (at 0.5 intervals)
// Value: [liters, increment_per_mm]
export const DIP_CHART_15KL: Record<number, [number, number]> = {
    0.5: [3.30, 1.21],
    1.0: [9.35, 1.21],
    1.5: [17.17, 1.56],
    2.0: [26.41, 1.85],
    2.5: [36.89, 2.10],
    3.0: [48.45, 2.31],
    3.5: [61.01, 2.51],
    4.0: [74.49, 2.70],
    4.5: [88.81, 2.86],
    5.0: [103.94, 3.03],
    5.5: [119.82, 3.18],
    6.0: [136.43, 3.32],
    6.5: [153.71, 3.46],
    7.0: [171.65, 3.59],
    7.5: [190.23, 3.72],
    8.0: [209.40, 3.83],
    8.5: [229.16, 3.95],
    9.0: [249.48, 4.06],
    9.5: [270.35, 4.17],
    10.0: [291.75, 4.28],
    10.5: [313.66, 4.38],
    11.0: [336.06, 4.48],
    11.5: [358.95, 4.58],
    12.0: [382.32, 4.67],
    12.5: [406.14, 4.76],
    13.0: [430.42, 4.86],
    13.5: [455.13, 4.94],
    14.0: [480.27, 5.03],
    14.5: [505.83, 5.11],
    15.0: [531.80, 5.19],
    15.5: [558.17, 5.27],
    16.0: [584.93, 5.35],
    16.5: [612.08, 5.43],
    17.0: [639.60, 5.50],
    17.5: [667.49, 5.58],
    18.0: [695.75, 5.65],
    18.5: [724.36, 5.72],
    19.0: [753.32, 5.79],
    19.5: [782.63, 5.86],
    20.0: [812.27, 5.93],
    20.5: [842.24, 5.99],
    21.0: [872.54, 6.06],
    21.5: [903.16, 6.12],
    22.0: [934.09, 6.19],
    22.5: [965.33, 6.25],
    23.0: [996.88, 6.31],
    23.5: [1028.73, 6.37],
    24.0: [1060.87, 6.43],
    24.5: [1093.30, 6.49],
    25.0: [1126.02, 6.54],
    25.5: [1159.02, 6.60],
    26.0: [1192.30, 6.66],
    26.5: [1225.85, 6.71],
    27.0: [1259.67, 6.76],
    27.5: [1293.76, 6.82],
    28.0: [1328.10, 6.87],
    28.5: [1362.71, 6.92],
    29.0: [1397.57, 6.97],
    29.5: [1432.68, 7.02],
    30.0: [1468.03, 7.07],
    30.5: [1503.63, 7.12],
    31.0: [1539.47, 7.17],
    31.5: [1575.55, 7.22],
    32.0: [1611.86, 7.26],
    32.5: [1648.40, 7.31],
    33.0: [1685.17, 7.35],
    33.5: [1722.16, 7.40],
    34.0: [1759.37, 7.44],
    34.5: [1796.81, 7.49],
    35.0: [1834.45, 7.53],
    35.5: [1872.31, 7.57],
    36.0: [1910.38, 7.61],
    36.5: [1948.66, 7.66],
    37.0: [1987.14, 7.70],
    37.5: [2025.82, 7.74],
    38.0: [2064.70, 7.78],
    38.5: [2103.78, 7.82],
    39.0: [2143.05, 7.85],
    39.5: [2182.51, 7.89],
    40.0: [2222.16, 7.93],
    40.5: [2261.99, 7.97],
    41.0: [2302.02, 8.01],
    41.5: [2342.22, 8.04],
    42.0: [2382.60, 8.08],
    42.5: [2423.16, 8.11],
    43.0: [2463.89, 8.15],
    43.5: [2504.79, 8.18],
    44.0: [2545.87, 8.22],
    44.5: [2587.11, 8.25],
    45.0: [2628.52, 8.28],
    45.5: [2670.09, 8.31],
    46.0: [2711.83, 8.35],
    46.5: [2753.72, 8.38],
    47.0: [2795.77, 8.41],
    47.5: [2837.98, 8.44],
    48.0: [2880.34, 8.47],
    48.5: [2922.85, 8.50],
    49.0: [2965.51, 8.53],
    49.5: [3008.31, 8.56],
    50.0: [3051.27, 8.59],
    50.5: [3094.36, 8.62],
    51.0: [3137.60, 8.65],
    51.5: [3180.97, 8.67],
    52.0: [3224.49, 8.70],
    52.5: [3268.14, 8.73],
    53.0: [3311.92, 8.76],
    53.5: [3355.84, 8.78],
    54.0: [3399.89, 8.81],
    54.5: [3444.06, 8.83],
    55.0: [3488.37, 8.86],
    55.5: [3532.79, 8.88],
    56.0: [3577.35, 8.91],
    56.5: [3622.02, 8.93],
    57.0: [3666.81, 8.96],
    57.5: [3711.72, 8.98],
    58.0: [3756.75, 9.01],
    58.5: [3801.89, 9.03],
    59.0: [3847.15, 9.05],
    59.5: [3892.52, 9.07],
    60.0: [3938.00, 9.10],
    60.5: [3983.58, 9.12],
    61.0: [4029.28, 9.14],
    61.5: [4075.08, 9.16],
    62.0: [4120.98, 9.18],
    62.5: [4166.98, 9.20],
    63.0: [4213.09, 9.22],
    63.5: [4259.29, 9.24],
    64.0: [4305.59, 9.26],
    64.5: [4351.99, 9.28],
    65.0: [4398.48, 9.30],
    65.5: [4445.06, 9.32],
    66.0: [4491.74, 9.34],
    66.5: [4538.50, 9.35],
    67.0: [4585.35, 9.37],
    67.5: [4632.30, 9.39],
    68.0: [4679.32, 9.40],
    68.5: [4726.43, 9.42],
    69.0: [4773.62, 9.44],
    69.5: [4820.89, 9.45],
    70.0: [4868.25, 9.47],
    70.5: [4915.68, 9.49],
    71.0: [4963.18, 9.50],
    71.5: [5010.77, 9.52],
    72.0: [5058.42, 9.53],
    72.5: [5106.15, 9.55],
    73.0: [5153.95, 9.56],
    73.5: [5201.82, 9.57],
    74.0: [5249.76, 9.59],
    74.5: [5297.76, 9.60],
    75.0: [5345.83, 9.61],
    75.5: [5393.97, 9.63],
    76.0: [5442.17, 9.64],
    76.5: [5490.42, 9.65],
    77.0: [5538.74, 9.66],
    77.5: [5587.12, 9.68],
    78.0: [5635.55, 9.69],
    78.5: [5684.05, 9.70],
    79.0: [5732.59, 9.71],
    79.5: [5781.19, 9.72],
    80.0: [5829.84, 9.73],
    80.5: [5878.54, 9.74],
    81.0: [5927.29, 9.75],
    81.5: [5976.09, 9.76],
    82.0: [6024.94, 9.77],
    82.5: [6073.83, 9.78],
    83.0: [6122.76, 9.79],
    83.5: [6171.74, 9.80],
    84.0: [6220.76, 9.80],
    84.5: [6269.82, 9.81],
    85.0: [6318.92, 9.82],
    85.5: [6368.06, 9.83],
    86.0: [6417.23, 9.83],
    86.5: [6466.44, 9.84],
    87.0: [6515.68, 9.85],
    87.5: [6564.95, 9.85],
    88.0: [6614.26, 9.86],
    88.5: [6663.59, 9.87],
    89.0: [6712.96, 9.87],
    89.5: [6762.35, 9.88],
    90.0: [6811.77, 9.88],
    90.5: [6861.21, 9.89],
    91.0: [6910.68, 9.89],
    91.5: [6960.17, 9.90],
    92.0: [7009.68, 9.90],
    92.5: [7059.21, 9.91],
    93.0: [7108.76, 9.91],
    93.5: [7158.33, 9.91],
    94.0: [7207.91, 9.92],
    94.5: [7257.51, 9.92],
    95.0: [7307.12, 9.92],
    95.5: [7356.74, 9.93],
    96.0: [7406.38, 9.93],
    96.5: [7456.02, 9.93],
    97.0: [7505.68, 9.93],
    97.5: [7555.34, 9.93],
    98.0: [7605.00, 9.93],
    98.5: [7654.68, 9.94],
    99.0: [7704.35, 9.93],
    99.5: [7754.03, 9.94],
    100.0: [7803.71, 9.94],
    100.5: [7853.39, 9.94],
    101.0: [7903.07, 9.94],
    101.5: [7952.75, 9.94],
    102.0: [8002.42, 9.93],
    102.5: [8052.09, 9.93],
    103.0: [8101.76, 9.93],
    103.5: [8151.40, 9.93],
    104.0: [8201.05, 9.93],
    104.5: [8250.68, 9.93],
    105.0: [8300.30, 9.92],
    105.5: [8349.92, 9.92],
    106.0: [8399.51, 9.92],
    106.5: [8449.10, 9.92],
    107.0: [8498.66, 9.91],
    107.5: [8548.21, 9.91],
    108.0: [8597.74, 9.91],
    108.5: [8647.25, 9.90],
    109.0: [8696.74, 9.90],
    109.5: [8746.21, 9.89],
    110.0: [8795.65, 9.89],
    110.5: [8845.07, 9.88],
    111.0: [8894.46, 9.88],
    111.5: [8943.83, 9.87],
    112.0: [8993.16, 9.87],
    112.5: [9042.47, 9.86],
    113.0: [9091.74, 9.85],
    113.5: [9140.99, 9.85],
    114.0: [9190.19, 9.84],
    114.5: [9239.37, 9.84],
    115.0: [9288.50, 9.83],
    115.5: [9337.60, 9.82],
    116.0: [9386.66, 9.81],
    116.5: [9435.68, 9.80],
    117.0: [9484.66, 9.80],
    117.5: [9533.59, 9.79],
    118.0: [9582.49, 9.78],
    118.5: [9631.33, 9.77],
    119.0: [9680.13, 9.76],
    119.5: [9728.88, 9.75],
    120.0: [9777.58, 9.74],
    120.5: [9826.23, 9.73],
    121.0: [9874.83, 9.72],
    121.5: [9923.38, 9.71],
    122.0: [9971.87, 9.70],
    122.5: [10020.30, 9.69],
    123.0: [10068.68, 9.68],
    123.5: [10117.00, 9.66],
    124.0: [10165.26, 9.65],
    124.5: [10213.45, 9.64],
    125.0: [10261.59, 9.63],
    125.5: [10309.66, 9.61],
    126.0: [10357.66, 9.60],
    126.5: [10405.60, 9.59],
    127.0: [10453.47, 9.57],
    127.5: [10501.27, 9.56],
    128.0: [10549.00, 9.55],
    128.5: [10596.66, 9.53],
    129.0: [10644.24, 9.52],
    129.5: [10691.74, 9.50],
    130.0: [10739.18, 9.49],
    130.5: [10786.53, 9.47],
    131.0: [10833.80, 9.45],
    131.5: [10880.99, 9.44],
    132.0: [10928.10, 9.42],
    132.5: [10975.13, 9.41],
    133.0: [11022.07, 9.39],
    133.5: [11068.92, 9.37],
    134.0: [11115.69, 9.35],
    134.5: [11162.36, 9.33],
    135.0: [11208.94, 9.32],
    135.5: [11255.44, 9.30],
    136.0: [11301.83, 9.28],
    136.5: [11348.13, 9.26],
    137.0: [11394.34, 9.24],
    137.5: [11440.44, 9.22],
    138.0: [11486.45, 9.20],
    138.5: [11532.35, 9.18],
    139.0: [11578.15, 9.16],
    139.5: [11623.84, 9.14],
    140.0: [11669.43, 9.12],
    140.5: [11714.90, 9.09],
    141.0: [11760.27, 9.07],
    141.5: [11805.53, 9.05],
    142.0: [11850.67, 9.03],
    142.5: [11895.70, 9.01],
    143.0: [11940.61, 8.98],
    143.5: [11985.40, 8.96],
    144.0: [12030.08, 8.94],
    144.5: [12074.63, 8.91],
    145.0: [12119.06, 8.89],
    145.5: [12163.36, 8.86],
    146.0: [12207.53, 8.83],
    146.5: [12251.58, 8.81],
    147.0: [12295.50, 8.78],
    147.5: [12339.28, 8.76],
    148.0: [12382.93, 8.73],
    148.5: [12426.45, 8.70],
    149.0: [12469.82, 8.67],
    149.5: [12513.06, 8.65],
    150.0: [12556.16, 8.62],
    150.5: [12599.11, 8.59],
    151.0: [12641.92, 8.56],
    151.5: [12684.58, 8.53],
    152.0: [12727.08, 8.50],
    152.5: [12769.44, 8.47],
    153.0: [12811.66, 8.44],
    153.5: [12853.70, 8.41],
    154.0: [12895.59, 8.38],
    154.5: [12937.33, 8.35],
    155.0: [12978.90, 8.31],
    155.5: [13020.31, 8.28],
    156.0: [13061.55, 8.25],
    156.5: [13102.63, 8.22],
    157.0: [13143.53, 8.18],
    157.5: [13184.27, 8.15],
    158.0: [13224.82, 8.11],
    158.5: [13265.21, 8.08],
    159.0: [13305.41, 8.04],
    159.5: [13345.43, 8.00],
    160.0: [13385.26, 7.97],
    160.5: [13424.92, 7.93],
    161.0: [13464.38, 7.89],
    161.5: [13503.65, 7.85],
    162.0: [13542.72, 7.81],
    162.5: [13581.60, 7.78],
    163.0: [13620.29, 7.74],
    163.5: [13658.77, 7.70],
    164.0: [13697.04, 7.65],
    164.5: [13735.11, 7.61],
    165.0: [13772.97, 7.57],
    165.5: [13810.62, 7.53],
    166.0: [13848.05, 7.49],
    166.5: [13885.26, 7.44],
    167.0: [13922.26, 7.40],
    167.5: [13959.02, 7.35],
    168.0: [13995.56, 7.31],
    168.5: [14031.87, 7.26],
    169.0: [14067.95, 7.22],
    169.5: [14103.79, 7.17],
    170.0: [14139.39, 7.12],
    170.5: [14174.75, 7.07],
    171.0: [14209.85, 7.02],
    171.5: [14244.71, 6.97],
    172.0: [14279.32, 6.92],
    172.5: [14313.67, 6.87],
    173.0: [14347.75, 6.82],
    173.5: [14381.57, 6.76],
    174.0: [14415.12, 6.71],
    174.5: [14448.40, 6.66],
    175.0: [14481.40, 6.60],
    175.5: [14514.12, 6.54],
    176.0: [14546.55, 6.49],
    176.5: [14578.69, 6.43],
    177.0: [14610.54, 6.37],
    177.5: [14642.09, 6.31],
    178.0: [14673.33, 6.25],
    178.5: [14704.26, 6.19],
    179.0: [14734.88, 6.12],
    179.5: [14765.18, 6.06],
    180.0: [14795.15, 5.99],
    180.5: [14824.80, 5.93],
    181.0: [14854.10, 5.86],
    181.5: [14883.06, 5.79],
    182.0: [14911.67, 5.72],
    182.5: [14939.93, 5.65],
    183.0: [14967.82, 5.58],
    183.5: [14995.35, 5.51],
    184.0: [15022.49, 5.43],
    184.5: [15049.25, 5.35],
    185.0: [15075.62, 5.27],
    185.5: [15101.59, 5.19],
    186.0: [15127.15, 5.11],
    186.5: [15152.29, 5.03],
    187.0: [15177.00, 4.94],
    187.5: [15201.28, 4.86],
    188.0: [15225.10, 4.76],
    188.5: [15248.47, 4.67],
    189.0: [15271.38, 4.58],
    189.5: [15293.77, 4.48],
    190.0: [15315.68, 4.38],
    190.5: [15337.07, 4.28],
    191.0: [15357.94, 4.17],
    191.5: [15378.26, 4.06],
    192.0: [15398.02, 3.95],
    192.5: [15417.20, 3.84],
    193.0: [15435.77, 3.71],
    193.5: [15453.71, 3.59],
    194.0: [15471.00, 3.46],
    194.5: [15487.60, 3.32],
    195.0: [15503.48, 3.18],
    195.5: [15518.61, 3.03],
    196.0: [15532.94, 2.87],
    196.5: [15546.41, 2.69],
    197.0: [15558.97, 2.51],
    197.5: [15570.54, 2.31],
    198.0: [15581.01, 2.09],
    198.5: [15590.28, 1.85],
    199.0: [15598.07, 1.56],
    199.5: [15604.12, 1.21],
    200.0: [15607.43, 0.66],
};

// Placeholder for 20KL chart - will be populated later
export const DIP_CHART_20KL: Record<number, [number, number]> = {};

/**
 * Calculate liters from DIP reading using interpolation
 * 
 * Formula:
 * 1. Find base dip (floor to nearest 0.5)
 * 2. Get base liters and increment per mm from chart
 * 3. Calculate extra mm from decimal part
 * 4. Liters = base_liters + (extra_mm * increment_per_mm)
 * 
 * Example: DIP = 56.2
 * - Base = 56.0 → 3577.35 L, increment = 8.91 L/mm
 * - Extra = 0.2 cm = 2 mm
 * - Result = 3577.35 + (2 × 8.91) = 3595.17 L
 */
export function calculateLitersFromDip(dipReading: number, tankType: 'Petrol' | 'Diesel'): number | null {
    // Select the appropriate chart based on tank type
    // For now, both use 15KL chart. Will update when 20KL is added.
    const chart = tankType === 'Petrol' ? DIP_CHART_15KL : DIP_CHART_20KL;

    // If chart is empty (20KL not yet added), return null
    if (Object.keys(chart).length === 0) {
        return null;
    }

    // Validate input
    if (dipReading < 0.5 || dipReading > 200) {
        return null;
    }

    // Find the base dip value (floor to nearest 0.5)
    const baseDip = Math.floor(dipReading * 2) / 2;

    // Get data from chart
    const chartData = chart[baseDip];
    if (!chartData) {
        return null;
    }

    const [baseLiters, incrementPerMm] = chartData;

    // Calculate the fractional part in mm
    // (dipReading - baseDip) is in cm, multiply by 10 to get mm
    const extraMm = (dipReading - baseDip) * 10;

    // Calculate total liters
    const totalLiters = baseLiters + (extraMm * incrementPerMm);

    // Round to nearest whole number
    return Math.round(totalLiters);
}

/**
 * Get tank type based on capacity
 * 15KL = Petrol, 20KL = Diesel (based on user's setup)
 */
export function getTankChartType(capacity: number): 'Petrol' | 'Diesel' {
    return capacity <= 15000 ? 'Petrol' : 'Diesel';
}
